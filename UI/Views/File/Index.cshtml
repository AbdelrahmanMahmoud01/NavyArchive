@using Application.Features.Pagintaion
@using Infrastructure
@model IEnumerable<Domain.Entites.FileInfo>
@inject Microsoft.AspNetCore.Identity.SignInManager<ApplicationUser> signInManger 

@{
    ViewData["Title"] = "Index";

    Pager pager = new Pager();

    int pageNo = 0;
    if(ViewBag.Pager is not null)
    {
        pager = ViewBag.Pager;
        pageNo = pager.CurrentPage;
    }
}

<h1 class="text-primary">الصفحة الرئيسية</h1>
<div id="PlaceHolderHere"></div>

<p class="mt-3">
    <a asp-action="Create" class="btn btn-outline-primary">إنشاء ملف</a>
</p>
  <form class="form-inline mb-5" style="margin-bottom:10px;" asp-action="Search">
    <input class="form-control mr-sm-2" style="width:93%; opacity:.85; direction:rtl;" name="term" 
    type="search" autocomplete="off" placeholder="إبحث عن  المرسل / القيد / الشأن / الضابط / القسم / الإجراء" 
    aria-label="Search" value="@ViewBag.Term">
    <button class="btn btn-primary my-2 my-sm-0" type="submit" style="width:6%;">بحث</button>
  </form>
<table class="table">
    <thead class="bg-primary">
        <tr style="color:white;">
            <th width="10%">
                المرسل
            </th>
            <th width="15%">
                ضابط
            </th>
            <th width="10%">
                قسم
            </th>
            <th width="20%">
                بشأن
            </th>
            <th width="15%">
                الإجراء
            </th>
            <th width="30%"></th>
        </tr>
    </thead>
    <tbody class="bg-white" style="opacity:.8">
@foreach (var item in Model) {
            <tr>
                <td>
                    @{
                        var src = "";
                        src = string.Join(" - ", item.FileInfoSoruce.Select(m => m.FileSource.Name));
                        <span>@src</span>
                     }
                 </td>
                 <td>
                    @{
                        var officer = "";
                        officer = string.Join(" - ", item.FileInfoOfficers.Select(m => m.Officer.Name));
                        <span>@officer</span>
                     }
                 </td>
                 <td>
                    @{
                        var department = "";
                        department = string.Join(" - ", item.FileInfoOfficers.Select(m => m.Officer.Destination.Name));
                        <span>@department</span>
                     }
                 </td>
            <td>
              @if(item.AboutUrl != null)
              {
                <a href="~/images/@item.AboutUrl" target="_blank">@item.AboutTag</a>
              }
              else
              {
                  @Html.DisplayFor(modelItem => item.AboutTag)
              }
                </td>
            <td>
                @if (item.ProcedcureUrl != null)
                {
                    var query = item.ProcedcureTage is null ? "تم اتخاذ الاجراء" : @item.ProcedcureTage;
                    <a href="~/images/@item.ProcedcureUrl" target="_blank">@query</a>
                }
                else if(item.ProcedcureTage != null)
                {
                    @Html.DisplayFor(modelItem => item.ProcedcureTage)
                }
                else
                {
                    <span>لا يوجد</span>
                }
            </td>
            <td>
                <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-primary">تفاصيل</a>                    
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-outline-primary">تعديل</a> 
                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-outline-danger">حذف</a>
                    <button type="button" class="btn btn-outline-light " data-toggle="ajax-modal"
                    data-target="#addEmployee" data-url="@Url.Action($"EditModal/{item.Id}")">
                    <img src="~/img/share.png" alt="Logo" style="width:1rem;">
                    </button>

            </td>
        </tr>
}
    </tbody>
</table>

<partial name="_Pager" model="@pager"></partial>


